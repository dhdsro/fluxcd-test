apiVersion: helm.cattle.io/v1
kind: HelmChart
metadata:
  name: traefik
  namespace: kube-system
spec:
  repo: https://traefik.github.io/charts
  chart: traefik
  version: 28.0.0
  targetNamespace: kube-system
  valuesContent: |
    image:
      tag: "v3.5.0"
    
    # Override the default ports configuration
    ports:
      web:
        port: 80
        expose: true
        exposedPort: 80
      websecure:
        port: 443
        expose: true
        exposedPort: 443
      traefik:
        port: 9000
        expose: false
      metrics:
        port: 9100
        expose: false
    
    # Use deployment.additionalArguments instead of additionalArguments
    deployment:
      additionalArguments:
        - --global.checknewversion
        - --global.sendanonymoususage
        - --api.dashboard=true
        - --ping=true
        - --metrics.prometheus=true
        - --metrics.prometheus.entrypoint=metrics
        - --providers.kubernetescrd
        - --providers.kubernetesingress
        - --providers.kubernetesingress.ingressendpoint.publishedservice=kube-system/traefik
        - --entrypoints.websecure.http.tls=true
        - --providers.kubernetesgateway
    
    service:
      type: ClusterIP